{
  "custom": {
    "chat_id": ""
  },
  "params": {
    "openByDefault": true
  },
  "propConfig": {
    "custom.chat_id": {
      "persistent": true
    },
    "params.openByDefault": {
      "paramDirection": "input",
      "persistent": true
    }
  },
  "props": {
    "defaultSize": {
      "height": 965,
      "width": 301
    }
  },
  "root": {
    "children": [
      {
        "children": [
          {
            "children": [
              {
                "meta": {
                  "name": "Nav Large BP"
                },
                "position": {
                  "basis": "100px"
                },
                "props": {
                  "fit": {
                    "height": 28,
                    "mode": "contain",
                    "width": 72
                  },
                  "source": "/system/images/iggy.png",
                  "style": {
                    "classes": "nav-logo-2",
                    "height": "70px"
                  }
                },
                "type": "ia.display.image"
              }
            ],
            "meta": {
              "name": "Top Logo"
            },
            "position": {
              "basis": "80px",
              "shrink": 0
            },
            "props": {
              "alignItems": "center",
              "justify": "center",
              "style": {
                "overflow": "hidden"
              }
            },
            "type": "ia.container.flex"
          },
          {
            "children": [
              {
                "meta": {
                  "name": "Icon"
                },
                "position": {
                  "basis": "30px"
                },
                "props": {
                  "path": "material/add"
                },
                "type": "ia.display.icon"
              },
              {
                "meta": {
                  "name": "Label"
                },
                "position": {
                  "shrink": 0
                },
                "props": {
                  "style": {
                    "paddingLeft": "10px"
                  },
                  "text": "New Chat"
                },
                "type": "ia.display.label"
              }
            ],
            "events": {
              "dom": {
                "onClick": {
                  "config": {
                    "script": "\tsystem.perspective.sendMessage(\u0027chat_id\u0027,{\u0027chat_id\u0027:\u0027\u0027})"
                  },
                  "scope": "G",
                  "type": "script"
                }
              }
            },
            "meta": {
              "name": "FlexContainer_newChat"
            },
            "position": {
              "shrink": 0
            },
            "props": {
              "style": {
                "classes": "icon",
                "marginBottom": "10px"
              }
            },
            "type": "ia.container.flex"
          },
          {
            "meta": {
              "name": "FlexRepeater_chatHistory"
            },
            "position": {
              "basis": "320px",
              "grow": 1
            },
            "propConfig": {
              "props.instances": {
                "binding": {
                  "config": {
                    "enableValueCache": false,
                    "parameters": {
                      "username": "{session.props.auth.user.userName}"
                    },
                    "queryPath": "Exchange/Iggy/Chat/getAllSessions",
                    "returnFormat": "json"
                  },
                  "transforms": [
                    {
                      "code": "\tchat_id \u003d self.view.custom.chat_id\n\tfor chat in value:\n\t    # Use .get() to avoid errors if \"chat_id\" key doesn\u0027t exist\n\t    if chat.get(\"chat_id\") !\u003d chat_id:\n\t        chat[\"selected\"] \u003d False\n\t    else:\n\t        chat[\"selected\"] \u003d True\n\treturn value",
                      "type": "script"
                    }
                  ],
                  "type": "query"
                }
              }
            },
            "props": {
              "direction": "column",
              "elementPosition": {
                "basis": "auto",
                "grow": 0,
                "shrink": 0
              },
              "path": "Exchange/Iggy/Navigation/chatItem",
              "useDefaultViewHeight": false,
              "useDefaultViewWidth": false
            },
            "type": "ia.display.flex-repeater"
          },
          {
            "children": [
              {
                "meta": {
                  "name": "Icon"
                },
                "position": {
                  "basis": "30px"
                },
                "propConfig": {
                  "props.path": {
                    "binding": {
                      "config": {
                        "path": "session.props.theme"
                      },
                      "transforms": [
                        {
                          "code": "\tif \"light\" in value:\n\t\treturn \"material/wb_sunny\"\n\telse:\n\t\treturn \"material/nights_stay\"",
                          "type": "script"
                        }
                      ],
                      "type": "property"
                    }
                  }
                },
                "type": "ia.display.icon"
              },
              {
                "meta": {
                  "name": "Label"
                },
                "position": {
                  "shrink": 0
                },
                "propConfig": {
                  "props.text": {
                    "binding": {
                      "config": {
                        "expression": "concat(\r\n    upper(left({session.props.theme}, 1)),\r\n    lower(substring({session.props.theme}, 1)), \r\n    \" Theme\"\r\n)\r\n"
                      },
                      "type": "expr"
                    }
                  }
                },
                "props": {
                  "style": {
                    "paddingLeft": "10px"
                  }
                },
                "type": "ia.display.label"
              }
            ],
            "events": {
              "dom": {
                "onClick": {
                  "config": {
                    "script": "\ttheme \u003d self.session.props.theme\n\t\n\tif \"light-cool\" in theme:\n\t\tself.session.props.theme \u003d \"dark-cool\"\n\telse:\n\t\tself.session.props.theme \u003d \"light-cool\""
                  },
                  "scope": "G",
                  "type": "script"
                }
              }
            },
            "meta": {
              "name": "FlexContainer_theme"
            },
            "position": {
              "shrink": 0
            },
            "props": {
              "style": {
                "classes": "icon"
              }
            },
            "type": "ia.container.flex"
          }
        ],
        "meta": {
          "name": "Nav"
        },
        "position": {
          "grow": 1,
          "shrink": 0
        },
        "props": {
          "direction": "column"
        },
        "type": "ia.container.flex"
      }
    ],
    "meta": {
      "domId": "nav",
      "name": "root"
    },
    "props": {
      "direction": "column",
      "style": {
        "classes": "nav nav-open",
        "marginBottom": "5px",
        "marginTop": "5px",
        "padding": "5px"
      }
    },
    "scripts": {
      "customMethods": [],
      "extensionFunctions": null,
      "messageHandlers": [
        {
          "messageType": "chat_id",
          "pageScope": true,
          "script": "\t#comes from Exchange/Responsive Nav/chatItem on click event\n\t\n\tself.view.custom.chat_id \u003d payload[\u0027chat_id\u0027]\n\t",
          "sessionScope": false,
          "viewScope": false
        },
        {
          "messageType": "refresh",
          "pageScope": true,
          "script": "\t#from refresh web dev resource\n#\tsystem.util.getLogger(\u0027Page nav root container\u0027).info(str(payload))\n\tif payload[\u0027type\u0027] \u003d\u003d \u0027summary\u0027:\n\t\tself.getChild(\"Nav\").getChild(\"FlexRepeater_chatHistory\").refreshBinding(\u0027props.instances\u0027)\n\tif payload[\u0027type\u0027] \u003d\u003d \u0027chat\u0027:\n\t\turl \u003d \"http://n8n:5678/webhook/chat-summary\"\n\t\tpostData \u003d {\n\t\t\t\"session_id\": payload[\u0027session_id\u0027],\n\t\t\t\"chat_id\": payload[\u0027chat_id\u0027]\n\t\t}\n\t\texchange.iggy.n8n_integration.n8n_post(url,postData)\n\t    ",
          "sessionScope": true,
          "viewScope": false
        }
      ]
    },
    "type": "ia.container.flex"
  }
}